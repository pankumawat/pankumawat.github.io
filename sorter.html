<!doctype html>
<html lang="en">
  <head>
    <!--
        Bootstrap 4
        https://getbootstrap.com/docs/4.6/getting-started/introduction/
    -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>

</head>

<style type="text/css">

thead th {
  cursor: pointer;
  width: 10px;
}

thead th.sort-asc span:after {
    content: '\21E7';
    margin-left: 0.3em;
}

thead th.sort-desc span:after {
    content: '\21E9';
    margin-left: 0.3em;
}

tbody tr td {
	margin-left: 0.5em;
}

body {
  margin: 0.5em;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

#sortable-table-main {
table-layout: fixed;
width: 100%;
}

.hide {
	display: none;
}

.nopadding {
	padding: 0px;
}

</style>

<body class="bg-secondary">
<div class="container p-5 my-3 bg-light">
	<table class="table mb-0" id = "sortable-table-main">
	    <thead>
	      <tr>
	        <!-- <th scope="col">label</th> -->
	      </tr>
	    </thead>
	    <tbody>
	      <tr>
	        <!-- <td>data</td> -->
	      </tr>
	  </tbody>
	</table>
</div>
</body>

<script type="text/javascript">
let tableDataJson = {
    cols: ["Name", "Age", "Gender", "Profile Pic"],
    dataType: {
        "Profile Pic": "LINK"
    },
    rows: [{
        "Name": "Pankaj",
        "Age": "35",
        "Gender": "Male",
        "Profile Pic": "Pankaj Kumawat"
    }, {
        "Name": "Neha",
        "Age": "34",
        "Gender": "Female",
        "Profile Pic": "Neha Dwivedi"
    }, {
        "Name": "Mayank",
        "Age": "25",
        "Gender": "Male",
        "Profile Pic": "Mayank Kumawat"
    }, {
        "Name": "Pranav",
        "Age": "2",
        "Gender": "Male",
        "Profile Pic": "Pranav Kumawat"
    }, {
        "Name": "Pranavi",
        "Age": "6",
        "Gender": "Female",
        "Profile Pic": "Pranavi Kumawat"
    }]
};


const removeAllChildren = (element) => {
    if (!!element && !!element.hasChildNodes) {
        while (element.hasChildNodes()) {
            element.removeChild(element.firstChild);
        }
    }
}

const getHeaderTitleItem = (columnName, index) => {
    const buttonsContainerId = `dropdownMenuButtonContainer_${index}`;
    const div = document.createElement("div");
    div.classList.add("dropdown");
    div.innerHTML = `
	<button class="btn dropdown-toggle  nopadding" type="button" id="dropdownMenuButton_${index}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    ${columnName}<span/>
  	</button>
  	<div class="dropdown-menu" aria-labelledby="dropdownMenuButton_${index}" id="${buttonsContainerId}">
  	<button class="dropdown-item">Sort &uarr;</button>
    <button class="dropdown-item">Sort &darr;</button>
    <input type = "text" style="margin-left: 15px; margin-right: 15px" placeholder="${columnName}"/>
  	</div>`;
    return div;
}

const clearAllSorting = () => {
    const tableHeaders = document.querySelectorAll("#sortable-table-main thead tr th");

    tableHeaders.forEach(th => {
        th.classList.toggle("sort-asc", false);
        th.classList.toggle("sort-desc", false)
    })
}

const addHeadItem = (headContainer, columnName, index) => {
	const th = document.createElement("th");
    th.appendChild(getHeaderTitleItem(columnName, index));
    headContainer.appendChild(th);
    const buttonsContainerId = `dropdownMenuButtonContainer_${index}`;
    const sortFilterParent = document.getElementById(buttonsContainerId);
    const ASCButton = sortFilterParent.children[0];
    const DESCButton = sortFilterParent.children[1];
    const filterTextBox = sortFilterParent.children[2];

    ASCButton.onclick = () => {
        clearAllSorting();
        th.classList.add("sort-asc");
        console.info("ORDER BY '" + columnName + "' ASC")
        sortTable(columnName, "ASC");
    }

    DESCButton.onclick = () => {
        clearAllSorting();
        th.classList.add("sort-desc");
        console.info("ORDER BY '" + columnName + "' DESC")
        sortTable(columnName, "DESC");
    }

    filterTextBox.onkeyup = (e) => {
        filterTable(columnName, e.target.value);
    }
}
const populateTableHeaders = (tableData) => {
    const {
        cols
    } = tableData;
    const headContainer = document.querySelector("#sortable-table-main thead tr");
    // Remove all existing <th/>
    removeAllChildren(headContainer);
    cols.forEach((columnName, index) => addHeadItem(headContainer, columnName, index));
}

const populateTableRow = (tableData, row) => {
    const {
        cols
    } = tableData;
    const tbodyContainer = document.querySelector("#sortable-table-main tbody");
    const tr = document.createElement("tr");

    cols.map(colName => ({
        rowData: row[colName],
        dataType: tableData.dataType[colName]
    })).forEach((rowItem) => {
        const {
            rowData,
            dataType
        } = rowItem;
        const td = document.createElement("td");
        if (!dataType || dataType === "TEXT") {
            td.innerHTML = rowData;
        } else if (dataType === "LINK") {
            const a = document.createElement("a");
            a.href = "https://www.google.com/search?tbm=isch&q=" + rowData;
            a.target = "_blank";
            a.innerHTML = rowData;
            td.appendChild(a);
        }
        tr.appendChild(td);
    });
    tbodyContainer.appendChild(tr);
}

const populateTableRows = (tableData) => {
    const {
        rows
    } = tableData;
    const tbodyContainer = document.querySelector("#sortable-table-main tbody");
    // // Remove all existing <th/>
    removeAllChildren(tbodyContainer);

    rows.forEach((row) => populateTableRow(tableData, row));
}

const sortTable = (columnName, order) => { // ASC, DESC, 
    if (!order) return populateTable(tableDataJson);

    const tableDataJsonCopy = JSON.parse(JSON.stringify(tableDataJson));
    if (["ASC", "DESC"].includes(order)) {
        const isNumeric = tableDataJsonCopy.rows.every(row => isFinite(row[columnName]))
        tableDataJsonCopy.rows.sort((r1, r2) => {
            const val1 = r1[columnName];
            const val2 = r2[columnName];
            return (isNumeric ? (val1 - val2) : val1.localeCompare(val2)) * (order === "ASC" ? 1 : -1);
        });
    }

    populateTableRows(tableDataJsonCopy);
    filterTable();
}

const filter = {};
const filterTable = (columnName, searchString) => { // ASC, DESC, 
    
    filter[columnName] = searchString;
    const tbodyContainerTrs = document.querySelectorAll("#sortable-table-main tbody tr");

    Array.from(tbodyContainerTrs).forEach(tr => {
        tr.classList.add("hide");

        const shouldShow = Object.keys(filter).every(cName => {
            if (!filter[cName]) return true;
            const columnIndex = tableDataJson.cols.indexOf(cName);
            return columnIndex === -1 || `${tr.children[columnIndex].textContent}`.toLowerCase().includes(filter[cName].toLowerCase());
        })

        if (shouldShow) {
            tr.classList.remove("hide");
        }
    })
}

const populateTable = (tableData) => { // {cols: ["A", "B"], rows: [{"Val A", "Val B"}]}
    populateTableHeaders(tableData);
    populateTableRows(tableData);
}

populateTable(tableDataJson);

</script>
</html>
